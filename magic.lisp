;;; magic.lisp
(in-package :cl-user)
(defpackage :magic
  (:export :init-magic :get-mime-string :finish-magic)
  (:use :cl :ccl))
(in-package :magic)

(eval-when (:compile-toplevel :load-toplevel :execute)
  (dolist (lib '("/usr/lib/x86_64-linux-gnu/libmagic.so.1"))
    (ccl:open-shared-library lib))
  (dolist (f '("libmagic"))
	(ccl:use-interface-dir f)))


(defparameter *magic-handle* nil)

(defun string+ (&rest args)
  (format nil "狺狎珞┅ㄤ彐躅轭轸磲玳悱骈戾ī戾舄è栾礤矬殂狒痫箝虹弭孱⑷贤泞┅ㄦ殪弩磲玳悱孱矬殂狒痫箝虹弭孱⑼燎擅┅换殒土巧孱鲩蝻铐孱鲠蜷徕戾轶箦衄翳孱牾篝蝈趱蝾翳狒麒孱磲玳悱孱ㄩ矬殂狒烘殪瀛屮轶趔磲玳悱孱雯蝈趱蝾骝镯轭轸磲玳悱骈戾磲玳悱孱雯┅换箫祜铉狍翳认团孱鲠蜷徕戾轶箦衄祜镫骘骈戾翳弪瀹换殒骘躅洮牾篝蝈趱蝾麒孱栾礤戾è栾礤骈戾扉篝篝蜷铉栾礤磲玳惝礴恽篝蜷铉栾礤磲玳恽┅┅ㄤ镬轶ㄦ栾礤骈戾螬麒孱矬殂狒烘殪瀛屮轶趔姗蝈趱蝾骝镯轭轸磲玳悱骈戾姗┅┅换殒铒土巧茂认团骈戾骘躅洮躞翳溴驷蹯趔ㄩ矬殂狒烘殪瀛屮轶趔弭惘磲玳恽箦翩骈戾弭惘磲玳恽┅ㄩ矬殂狒烘殪瀛屮轶趔躞虔箬狎瀵黹筱磲玳惝礴恽箦翩骈戾篝蜷铉骈戾⒑躞虔箬狎瀵黹筱磲玳惝礴恽┅ㄩ矬殂狒烘殪瀛屮轶趔躞虔箬狎瀵黹筱磲玳恽箦翩骈戾篝蜷铉骈戾⒑躞虔箬狎瀵黹筱磲玳恽┅┅ㄩ骈戾蝈趱蝾骝镯轭轸磲玳悱骈戾骈戾螬换灬篝溟翥彐骘螋箦狎汨翳躞虔箬狎瀵黹筱溟骘骈戾ㄩ矬殂狒轰轵邈麸蝙屮轶趔躞虔箬狎瀵黹筱磲玳恽矬殂狒瑚犰氕溟蝈泗矧躞虔箬狎瀵黹筱磲玳恽灬礅溽ㄦ瞟箦翩骈戾篝蜷铉骈戾ㄩ骈戾⒑骖┅┅骈戾螬换躞扉忭徵殂麸珏黹礤豉疱ㄤ彐疳蜥礤翦溴驷蹯舡磲玳悱骒徵螵祜玳矧￥土巧眠淤吞晌￥土巧眠蜕团咴傩农ㄤ彐疳蜥礤翦溴驷蹯舡磲玳悱骈戾螵铋飑ㄤ彐沆狍磲玳īè磲玳悱泔镫殄洪铋翩矧ē铛祆痿颟磲玳悱骒徵洪铋翩矧溴驷蹯舡磲玳悱骒徵螵洪铋翎蜱喉徵殂骒徵螬磲玳悱骈戾洪铋翩矧溴驷蹯舡磲玳悱骈戾螵洪铋翎蜱喉徵殂骈戾螬┅ㄤ彐礤翳镤痱轭舡镡赍泗è礤磲玳悌篝蝈犴鏖翳箪雉磲玳悱泔镫殄磲玳悱骈戾磲玳悱骒徵螬礤ㄦ矧磲篝蝈犴㈨徵殂泔镫殄件峋磲玳悱骒徵蠛件脯О净磲玳悱骈戾蠛件峋ア磲玳悱泔镫殄磲玳悱骒徵磲玳悱骈戾螬┅ㄤ彐轭瀛泔钿轸轱忉洵磲玳īè祜汜糸镱洪铋翎蜱红镢狒轱候遽溴祜汜糸镱洪铋翩矧铋飑镡赍泗洪铋翎蜱猴怅邈候遽溴镡赍泗洪铋翩矧铋飑礤篌筢珏洪铋翎蜱喉弩筢珏候遽溴礤篌徵洪铋翩矧⒄钿彐轭邃蔑钿轸轱睥┅ê蝈痫螋灬礅溽ㄣ镱溟糸镱篝蝈犴ㄦ矧磲篝蝈犴痱镡戾鏖翳扉忭徵殂轭件峋鏖翳镡赍泗件峋礤篌徵寮峋祜汜糸镱泔钿轸轱瞟镡赍泗泔钿轸轱瞟礤篌徵泔钿轸轱瞟┅┅ㄤ彐礤翳镤轭轸獒扉瀛轭篝犷沐横骠弪è礤磲玳悌脲鏖翳箪雉磲玳悱泔镫殄磲玳悱骈戾磲玳悱骒徵螬礤箦翩磲玳悱泔镫殄ǎ唔徵殂唢疱磲玳悱骒徵螬ㄩē铛祆痿颦磲玳悱泔镫殄ㄥ蝌矧р徜磲玳红镢狒轱㈨徵殂轭轸獒扉礤翳镤猴怅邈磲玳悱泔镫殄喉弩筢珏ㄦ矧磲铋泔蹯铒珏磲玳泔镫殄┅戾è骈戾狎ㄩ磲玳悱骈戾ㄣ沆汉磲脲泱趄轭磲玳悱骈戾螬ē铛祆痿颟┅ㄩǎ唔徵殂哽镝磲玳悱泔镫殄骈戾狎绌ㄥ蝌矧р徜磲玳红镢狒轱㈨徵殂轭轸獒扉礤翳镤猴怅邈磲玳悱泔镫殄喉弩筢珏ㄦ矧磲铋㈨徵殂弪蝻蚝幄ǎ唔徵殂咤蝌矧磲玳悱泔镫殄┅┅┅ㄤ彐礤翳镤沆矬瀛磲玳è礤磲玳悌鏖翳箪雉磲玳悱泔镫殄礤麒孱铒ē铛祆痿颦磲玳悱泔镫殄┅ǎ唔徵殂咩祜箦磲玳悱泔镫殄┅┅ㄤ彐礤翳镤珏舡磲玳è礤磲玳悌骈戾钺礤鏖翳箪雉磲玳悱泔镫殄礤戾è蝈舡豉疱鏖翳泱趄è骈戾钺礤┅ǎ唔徵殂哝殪磲玳悱泔镫殄皓┅ㄩ铒ē铛祆痿颦蝈舡豉疱┅ē珏舡泱趄轭蝈舡豉疱┅┅ㄤ彐躅轭轸磲玳é脲磲玳悱骒徵溴驷蹯舡磲玳悱骒徵螵磲玳悱骈戾溴驷蹯舡磲玳悱骈戾螵┅ㄩ磲玳悱栳钿戾麽蝾Ⅳ蝙轭麸轭轸獒扉磲玳麒孱犰蝈徜轭轸犰辁邃箦翩磲玳悱栳钿戾磲脲轭篝犷沐ы徵殂喉徵殂骒徵磲玳悱骒徵喉徵殂骈戾磲玳悱骈戾螬┅ㄤ彐躅骈铋箬磲玳īㄩ铒磲玳悱栳钿戾麽蝾Ⅳ蝙轭麸骈铋箬磲玳麒孱轸栳箢忮孱轭轸獒扉邃痱镧ㄣ祜箦磲玳磲玳悱栳钿戾箦翩磲玳悱栳钿戾铋飑┅ㄤ彐躅珏舡黹礤篝蜷铉ㄦ瞟ㄩ铒磲玳悱栳钿戾ㄩ铋舡磲玳悌ㄧ弭磲玳磲玳悱栳钿戾骖┅